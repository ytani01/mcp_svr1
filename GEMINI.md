# GEMINI.md

Gemini CLI のための開発ルール。

## 1. プロジェクトの目標

- **FastMCP** を使用した **MCPサーバー** のPythonプロジェクトを提供する。
- テンプレート、または、サンプルとして使うことが目的

## 2. プロジェクト全体のルール

- 実験する前には、十分にリサーチを行うこと。

- **`git commit` はユーザーのみが行う**
  - コミットが適切な場合は、ユーザーにコミットを促すこと。
  - 常に短く、一行のコミットメッセージを英語で提案すること。

- **プロジェクトの構成と管理**
  - `uv` と `pyproject.toml` を通じて行うこと。
  - 常に最新の `uv` 仕様に従うこと。

- **コマンドの実行**
  - 常に `uv run ...` を使用すること。
  - `venv`の`activate`は、明示的に行わないこと。

- **ライブラリのインストール/追加**:
  - `uv add ...` で行うこと。
  - `pip install ...`は使わない。

- **リンティング** は以下で実行すること:
  - `uv run ruff check ...`
  - `uv run mypy ...`
  - `uv run pyright ...`

- **テストプログラム**
  - `tests` ディレクトリの下に、連番で作成すること。
  - **テストの実行**: `uv run python -m pytest -v ...`

- **確実なファイル更新**
  - 新しいファイルを作成し、古いファイルを置き換えるのが一番確実。

### 2.1 学習とデバッグの原則

過去の失敗を繰り返さず、効率的な問題解決を確実にするために:

- **公式ドキュメントを優先する
  - ** コア機能、設定、認証については、常に一次情報源を参照すること。
  - 二次情報源からの思い込みを避けること。

- **すべての仮定を検証する
  - ** 命名、暗黙の振る舞い、デフォルト値を疑うこと。
  - 未確認のパターンを避けること。

- **体系的な問題の切り分け:**
  -  各コンポーネント（環境変数、ツール実行、サブプロセスなど）をテストして、根本原因を見つけること。

- **詳細なロギングを活用する:**
  -  内部の洞察と障害の特定のために、デバッグオプションを活用する。

- **ユーザーフィードバックを尊重すること**
  -  継続的な学習と問題診断のために、詳細なレポートを取り入れること。

## 3. コーディングルール

- ソースコード内のコメントは、通常は日本語で行うこと。
- 各行を78文字以内に収めること。
- デバッグログには `my_logger.py` の `get_logger()` を使用すること。
- `my_logger.py` は変更しないこと。

## 4. タスクの計画と実行: `ToDo.md` と `Tasks.md`

- `ToDo.md` は **ユーザーのみ** が作成・編集・管理する。
- `Tasks.md` はAIが作成し、管理する。

- まず、プロジェクトのルートに `ToDo.md` と `Tasks.md` が存在するかどうかを確認する。
  - どちらも存在しない場合は、何もしないで、ユーザーにどうするか尋ねること。

- いずれかのファイルが存在する場合は、以下のルールに従うこと。

- 作業を開始する前には、常に `Tasks.md` を作成
  - 実行を開始する前に、必ずユーザーに確認を求めること。
  - ユーザーが明確に **"go ahead"** と言うまで、処理を進めないこと。
  - 開始後は、`Tasks.md`の項目については、連続実行してもよい。

### 4.1 `Tasks.md` が存在する場合

- 未チェックのタスク項目を上から順番に実行する。
- ソースコードを修正した後は、常に以下を実行すること:
  - リンティングの実行
  - テストプログラムの作成、更新、実行

- `Tasks.md`のタスク項目が一つ完了するごとににマークする。

- タスク項目にないことを実行する必要が生じた場合、`Tasks.md` に追加してから実行する。

- `Tasks.md` を修正する場合:
  1. 実行する前に、必ずユーザーに確認を求めること。
  2. ユーザーが **"go ahead"** と言うまで、処理を進めないこと。

- `Tasks.md` のすべてのタスクが完了した場合
  1. ユーザーに完了を報告
  2. ユーザーが、`ToDo.md` を更新するよう促す。
  2. `uv run rename_task.py` を実行する。
     このスクリプトは:
     - `Tasks.md` を `yyyymmdd-HHMM-Tasks-done.md` にリネームする
       （`yyyymmdd` = 日付, `HHMM` = 時刻）。
     - ファイルを `archives` ディレクトリに移動する。

### 4.2 `Tasks.md` が存在しない場合

- `ToDo.md` をレビューする:
  - 先頭の未チェック項目を特定する。
  - 詳細なタスクに分割し、`Tasks.md` にチェックリストを作成する。
  - 原則として、`ToDo.md` の1項目 = `Tasks.md`ファイルが1つ。
  - `Tasks.md` を作成したら、実行する前に必ずユーザーに確認を求めること。
  - ユーザーが **"go ahead"** と言った場合は、タスクを順に実行する。
